!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.GifStream=t()}(this,function(){"use strict";function e(e){var t=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia;return t?new Promise(function(n,i){t.call(window.navigator,e,n,i)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=e.videoWidth,i=e.videoHeight;if(!n||!i)return"data:image/jpeg;base64,";s.width=t,s.height=t;var a=n/i,c=t+t/a/2,l=t,d=n>i?-t/a/4:0,v=n<=i?-t/a/4:0;return u.drawImage(e,d,v,c,l),s.toDataURL("image/jpeg",o)}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments[1],n=arguments[2];return new Promise(function(i,a){var r=new XMLHttpRequest;r.open(e,t),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?r.responseText.length>0?i(JSON.parse(r.responseText)):i():a())},r.send(n)})}function i(e,t,i){n("GET",e+"/api/upload?id="+i).then(function(e){n("PUT",e.signedUrl,t)})}function a(){return 9999999999999-Date.now()+Math.random().toString(36).substr(2,3)}var r=100,o=.8,s=document.createElement("canvas"),u=s.getContext("2d"),c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),d={callback:function(){},imageSize:100,interval:1e4,serverUrl:"http://localhost:3000"};return function(){function n(e){c(this,n),this.options=Object.assign({},d,e),this.video=document.createElement("video"),this.stream=null,this.intervalTask=null,this.sessionId=""}return l(n,[{key:"handleNext",value:function(){var e=t(this.video,this.options.imageSize);i(this.options.serverUrl,e,this.sessionId),this.options.callback({imageData:e})}},{key:"start",value:function(){var t=this;if(this.intervalTask)return Promise.resolve();var n={video:!0,audio:!1};return new Promise(function(i,r){e(n).then(function(e){t.stream=e;try{t.video.oncanplay=function(){t.sessionId=a(),t.intervalTask=setInterval(function(){t.handleNext()},t.options.interval)},t.video.src=window.URL.createObjectURL(t.stream),t.video.play(),i()}catch(e){r(e)}}).catch(r)})}},{key:"stop",value:function(){if(this.intervalTask){var e=this.stream.getTracks()[0];e&&e.stop(),clearInterval(this.intervalTask),this.intervalTask=null,this.sessionId=""}}}]),n}()});
//# sourceMappingURL=gif-stream.min.js.map
