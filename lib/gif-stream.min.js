!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).GifStream=t()}(this,function(){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=document.createElement("canvas"),l=d.getContext("2d");function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"GET",t=1<arguments.length?arguments[1]:void 0,i=2<arguments.length?arguments[2]:void 0;return window.fetch(t,{method:e,body:i}).then(function(e){if(!e.ok)throw new Error(e.statusText);return e.json()})}var i={callback:function(){},imageSize:100,interval:1e4,serverUrl:"http://localhost:3000"};return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=Object.assign({},i,e),this.video=document.createElement("video"),this.stream=null,this.intervalTask=null,this.sessionId=""}return function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(t,[{key:"handleNext",value:function(){var e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=e.videoWidth,n=e.videoHeight;if(!i||!n)return"data:image/jpeg;base64,";d.width=t;var a=i/n,o=(d.height=t)+t/a/2,r=t,s=n<i?-t/a/4:0,c=i<=n?-t/a/4:0;return l.drawImage(e,s,c,o,r),d.toDataURL("image/jpeg",.8)}(this.video,this.options.imageSize);!function(e,t,i){a("GET","".concat(e,"/api/upload?id=").concat(i)).then(function(e){a("PUT",e.signedUrl,t)})}(this.options.serverUrl,e,this.sessionId),this.options.callback({imageData:e})}},{key:"start",value:function(){var n=this;if(this.intervalTask)return Promise.resolve();var e={video:!0,audio:!1};return new Promise(function(t,i){(function(i){if(void 0===window.navigator.mediaDevices&&(window.navigator.mediaDevices={}),void 0!==window.navigator.mediaDevices.getUserMedia)return window.navigator.mediaDevices.getUserMedia(i);var n=window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia;return n?new Promise(function(e,t){n.call(window.navigator,i,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})(e).then(function(e){n.stream=e;try{n.video.oncanplay=function(){n.sessionId=9999999999999-Date.now()+Math.random().toString(36).substr(2,3),n.intervalTask=setInterval(function(){n.handleNext()},n.options.interval)},n.video.srcObject=n.stream,n.video.play(),t()}catch(e){i(e)}}).catch(i)})}},{key:"stop",value:function(){if(this.intervalTask){var e=this.stream.getTracks()[0];e&&e.stop(),clearInterval(this.intervalTask),this.intervalTask=null,this.sessionId=""}}}]),t}()});
//# sourceMappingURL=gif-stream.min.js.map
