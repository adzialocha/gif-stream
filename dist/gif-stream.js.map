{"version":3,"file":"gif-stream.js","sources":["../src/utils/polyfill.js","../src/image.js","../src/stream.js"],"sourcesContent":["export default function getUserMediaPolyfill(constraints) {\n  const getUserMedia = (window.navigator.getUserMedia ||\n      window.navigator.webkitGetUserMedia ||\n      window.navigator.mozGetUserMedia ||\n      window.navigator.msGetUserMedia)\n\n  if (!getUserMedia) {\n    return Promise.reject(\n      new Error('getUserMedia is not implemented in this browser')\n    )\n  }\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(window.navigator, constraints, resolve, reject)\n  })\n}\n","const DEFAULT_IMAGE_SIZE = 100\nconst IMAGE_QUALITY = 0.8\n\nconst canvas = document.createElement('canvas')\nconst context = canvas.getContext('2d')\n\nexport default function resizedVideostill(video, imageSize = DEFAULT_IMAGE_SIZE) {\n  const videoWidth = video.videoWidth\n  const videoHeight = video.videoHeight\n\n  if (!(videoWidth && videoHeight)) {\n    return 'data:image/jpeg;base64,'\n  }\n\n  canvas.width = imageSize\n  canvas.height = imageSize\n\n  const ratio = videoWidth / videoHeight\n  const targetWidth = imageSize + (imageSize / ratio / 2)\n  const targetHeight = imageSize\n  const xPos = videoWidth > videoHeight ? -(imageSize / ratio / 4) : 0\n  const yPos = videoWidth <= videoHeight ? -(imageSize / ratio / 4) : 0\n\n  context.drawImage(video, xPos, yPos, targetWidth, targetHeight)\n\n  return canvas.toDataURL('image/jpeg', IMAGE_QUALITY)\n}\n","import getUserMediaPolyfill from './utils/polyfill'\nimport resizedVideostill from './image'\n\nconst defaultOptions = {\n  interval: 10000,\n  imageSize: 100,\n  callback: () => {},\n}\n\nclass GifStream {\n  constructor(customOptions) {\n    this.options = Object.assign({}, defaultOptions, customOptions)\n    this.video = document.createElement('video')\n\n    this.stream = null\n    this.intervalTask = null\n  }\n\n  handleNext() {\n    const imageData = resizedVideostill(this.video, this.options.imageSize)\n\n    this.options.callback({\n      imageData,\n    })\n  }\n\n  start() {\n    if (this.intervalTask) {\n      return Promise.resolve()\n    }\n\n    const constraints = {\n      video: true,\n      audio: false,\n    }\n\n    return new Promise((resolve, reject) => {\n      getUserMediaPolyfill(constraints)\n        .then((stream) => {\n          this.stream = stream\n\n          try {\n            this.video.oncanplay = () => {\n              this.intervalTask = setInterval(() => {\n                this.handleNext()\n              }, this.options.interval)\n            }\n            this.video.src = window.URL.createObjectURL(this.stream)\n            this.video.play()\n\n            resolve()\n          } catch (error) {\n            reject(error)\n          }\n        })\n        .catch(reject)\n    })\n  }\n\n  stop() {\n    if (!this.intervalTask) {\n      return\n    }\n\n    const track = this.stream.getTracks()[0]\n    if (track) {\n      track.stop()\n    }\n\n    clearInterval(this.intervalTask)\n    this.intervalTask = null\n  }\n}\n\nexport default GifStream\n"],"names":["getUserMediaPolyfill","constraints","getUserMedia","window","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","Promise","reject","Error","resolve","call","DEFAULT_IMAGE_SIZE","IMAGE_QUALITY","canvas","document","createElement","context","getContext","resizedVideostill","video","imageSize","videoWidth","videoHeight","width","height","ratio","targetWidth","targetHeight","xPos","yPos","drawImage","toDataURL","defaultOptions","GifStream","customOptions","options","Object","assign","stream","intervalTask","imageData","callback","then","oncanplay","setInterval","handleNext","interval","src","URL","createObjectURL","play","error","catch","track","getTracks","stop"],"mappings":";;;;;;AAAe,SAASA,oBAAT,CAA8BC,WAA9B,EAA2C;MAClDC,eAAgBC,OAAOC,SAAP,CAAiBF,YAAjB,IAClBC,OAAOC,SAAP,CAAiBC,kBADC,IAElBF,OAAOC,SAAP,CAAiBE,eAFC,IAGlBH,OAAOC,SAAP,CAAiBG,cAHrB;MAKI,CAACL,YAAL,EAAmB;WACVM,QAAQC,MAAR,CACL,IAAIC,KAAJ,CAAU,iDAAV,CADK,CAAP;;SAKK,IAAIF,OAAJ,CAAY,UAACG,OAAD,EAAUF,MAAV,EAAqB;iBACzBG,IAAb,CAAkBT,OAAOC,SAAzB,EAAoCH,WAApC,EAAiDU,OAAjD,EAA0DF,MAA1D;GADK,CAAP;;;ACZF,IAAMI,qBAAqB,GAA3B;AACA,IAAMC,gBAAgB,GAAtB;AAEA,IAAMC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAf;AACA,IAAMC,UAAUH,OAAOI,UAAP,CAAkB,IAAlB,CAAhB;AAEA,AAAe,SAASC,iBAAT,CAA2BC,KAA3B,EAAkE;MAAhCC,SAAgC,uEAApBT,kBAAoB;MACzEU,aAAaF,MAAME,UAAzB;MACMC,cAAcH,MAAMG,WAA1B;MAEI,EAAED,cAAcC,WAAhB,CAAJ,EAAkC;WACzB,yBAAP;;SAGKC,KAAP,GAAeH,SAAf;SACOI,MAAP,GAAgBJ,SAAhB;MAEMK,QAAQJ,aAAaC,WAA3B;MACMI,cAAcN,YAAaA,YAAYK,KAAZ,GAAoB,CAArD;MACME,eAAeP,SAArB;MACMQ,OAAOP,aAAaC,WAAb,GAA2B,EAAEF,YAAYK,KAAZ,GAAoB,CAAtB,CAA3B,GAAsD,CAAnE;MACMI,OAAOR,cAAcC,WAAd,GAA4B,EAAEF,YAAYK,KAAZ,GAAoB,CAAtB,CAA5B,GAAuD,CAApE;UAEQK,SAAR,CAAkBX,KAAlB,EAAyBS,IAAzB,EAA+BC,IAA/B,EAAqCH,WAArC,EAAkDC,YAAlD;SAEOd,OAAOkB,SAAP,CAAiB,YAAjB,EAA+BnB,aAA/B,CAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBF,IAAMoB,iBAAiB;YACX,KADW;aAEV,GAFU;YAGX,oBAAM;CAHlB;IAMMC;qBACQC,aAAZ,EAA2B;;SACpBC,OAAL,GAAeC,OAAOC,MAAP,CAAc,EAAd,EAAkBL,cAAlB,EAAkCE,aAAlC,CAAf;SACKf,KAAL,GAAaL,SAASC,aAAT,CAAuB,OAAvB,CAAb;SAEKuB,MAAL,GAAc,IAAd;SACKC,YAAL,GAAoB,IAApB;;;;iCAGW;UACLC,YAAYtB,kBAAkB,KAAKC,KAAvB,EAA8B,KAAKgB,OAAL,CAAaf,SAA3C,CAAlB;WAEKe,OAAL,CAAaM,QAAb,CAAsB;;OAAtB;;;;4BAKM;;UACF,KAAKF,YAAT,EAAuB;eACdjC,QAAQG,OAAR,EAAP;;UAGIV,cAAc;eACX,IADW;eAEX;OAFT;aAKO,IAAIO,OAAJ,CAAY,UAACG,OAAD,EAAUF,MAAV,EAAqB;6BACjBR,WAArB,EACG2C,IADH,CACQ,UAACJ,MAAD,EAAY;gBACXA,MAAL,GAAcA,MAAd;cAEI;kBACGnB,KAAL,CAAWwB,SAAX,GAAuB,YAAM;oBACtBJ,YAAL,GAAoBK,YAAY,YAAM;sBAC/BC,UAAL;eADkB,EAEjB,MAAKV,OAAL,CAAaW,QAFI,CAApB;aADF;kBAKK3B,KAAL,CAAW4B,GAAX,GAAiB9C,OAAO+C,GAAP,CAAWC,eAAX,CAA2B,MAAKX,MAAhC,CAAjB;kBACKnB,KAAL,CAAW+B,IAAX;;WAPF,CAUE,OAAOC,KAAP,EAAc;mBACPA,KAAP;;SAfN,EAkBGC,KAlBH,CAkBS7C,MAlBT;OADK,CAAP;;;;2BAuBK;UACD,CAAC,KAAKgC,YAAV,EAAwB;;;UAIlBc,QAAQ,KAAKf,MAAL,CAAYgB,SAAZ,GAAwB,CAAxB,CAAd;UACID,KAAJ,EAAW;cACHE,IAAN;;oBAGY,KAAKhB,YAAnB;WACKA,YAAL,GAAoB,IAApB;;;;IAIJ;;;;"}