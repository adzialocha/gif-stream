!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.GifStream=t()}(this,function(){"use strict";function e(e){var t=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia;return t?new Promise(function(n,i){t.call(window.navigator,e,n,i)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,o=e.videoWidth,s=e.videoHeight;if(!o||!s)return"data:image/jpeg;base64,";a.width=t,a.height=t;var c=o/s,u=t+t/c/2,l=t,d=o>s?-t/c/4:0,v=o<=s?-t/c/4:0;return r.drawImage(e,d,v,u,l),a.toDataURL("image/jpeg",i)}var n=100,i=1,a=document.createElement("canvas"),r=a.getContext("2d"),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c={interval:1e4,imageSize:100,callback:function(){}};return function(){function n(e){o(this,n),this.options=Object.assign({},c,e),this.video=document.createElement("video"),this.intervalTask=null}return s(n,[{key:"handleNext",value:function(){var e=t(this.video,this.options.imageSize);this.options.callback({imageData:e})}},{key:"start",value:function(){var t=this;if(this.intervalTask)return Promise.reject(new Error("Stream is already running"));var n={video:!0,audio:!1};return new Promise(function(i,a){e(n).then(function(e){try{t.video.oncanplay=function(){t.handleNext(),t.intervalTask=setInterval(function(){t.handleNext()},t.options.interval)},t.video.src=window.URL.createObjectURL(e),t.video.play(),i()}catch(e){a(e)}}).catch(a)})}},{key:"stop",value:function(){this.intervalTask&&(clearInterval(this.intervalTask),this.intervalTask=null)}}]),n}()});
